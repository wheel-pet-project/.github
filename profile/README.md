Проект демонстрирует проектирование и реализацию распределенной информационной системы для каршеринг-компании. Система покрывает ключевые бизнес-процессы: учет автопарка, клиентов, бронирований и поездок, биллинг и платежи, уведомления и администрирование. Архитектура построена на DDD, микросервисах и событийно-ориентированном взаимодействии через Kafka. Для надежности применены SAGA (хореография), Transactional Outbox, Idempotent Consumer, корреляционные токены, трейсинг и метрики. Безопасность реализована на JWT.

## Функциональность

- [x] Управление автопарком: статусы ТС, телеметрия, обслуживание, история поездок
- [x] Клиенты: регистрация, KYC (проверка документов), блокировки/разблокировки
- [x] Бронирование и аренда: поиск на карте, резерв, фотофиксация
- [ ] Финансы: гибкие тарифы, расчеты, интеграция с платежными шлюзами, долги и штрафы, электронные чеки
- [ ] Администрирование: управление ролями и доступом, журналирование действий, зонами на карте, уведомления
- [ ] Отчетность и аналитика: загрузка парка, доходы, события и инциденты
- [ ] Наблюдаемость и устойчивость: метрики, логи, распределенный трейсинг, политики повторов, фоновые джобы

## Архитектура

Применены подходы DDD (Bounded Context) и Event Storeming для разрезания домена на микросервисы. Каждый микросервис коммуницирет асинхронно с другими сервисами. 

Принято решение отказаться от строгой согласованности в пользу итоговой. Для обеспечения согласованности при use кейсах, затрагивающих несколько микросервисов реализваны две хореографические саги.

Реализованы паттерны Transactional Outbox и Idempotent Consumer (Inbox).

Безопасность JWT (access/refresh), независимая проверка токена каждым сервисом пока не реализована, пока проверкой занимается микросервис identity.

## Микросервисы

#### BFF-шлюзы:
- [x] [Customer BFF](https://github.com/wheel-pet-project/customer-bff "Ссылка на репозиторий")
- [x] [Employee BFF](https://github.com/wheel-pet-project/employee-bff "Ссылка на репозиторий") 

В планах разделить Employee на большее количество BFF (для каждого потребителя, то есть Employee BFF → Hr BFF, Support Bff и т.д.).

#### Доменные сервисы:
- [x] [Identity](https://github.com/wheel-pet-project/identity "Ссылка на репозиторий") — Микросервис аутентификации и авторизации
- [x] [Notification](https://github.com/wheel-pet-project/notification "Ссылка на репозиторий") — Микросервис уведомлений
- [x] [DrivingLicense](https://github.com/wheel-pet-project/drivinglicense "Ссылка на репозиторий") — Микросервис подтверждения и отслеживания актуальности водительстких прав
- [x] [Booking](https://github.com/wheel-pet-project/booking "Ссылка на репозиторий") — Микросервис бронирования
- [x] [VehicleCheck](https://github.com/wheel-pet-project/car-check "Ссылка на репозиторий") — Микросервис проверки состояния автомобиля клиентом перед арендой
- [x] [VehicleDocuments](https://github.com/wheel-pet-project/vehicle-docs "Ссылка на репозиторий") — Микросервис для хранения документов от авто
- [x] [VehicleFleet](https://github.com/wheel-pet-project/vehicle-fleet "Ссылка на репозиторий") — Микросервис управления автопарком
- [x] [Rent](https://github.com/wheel-pet-project/rent "Ссылка на репозиторий") — Микросервис аренды авто

![](/assets/images/wheel-diagramm.png)

## Наблюдаемость

Метрики встроенные в: ASP.NET Core, Kestrel, gRPC, Npgsql, Quartz — через OpenTelemetry

Трейсинг: gRPC Interceptors для привязки X-Correlation-Id к span
В Jaeger видны сквозные треки: входящий gRPC → БД → Kafka produce/consume → фоновые задачи

Логи: Serilog, корреляция по токенам, структурированные записи

## Технологический стек

Платформа: .NET 8, ASP.NET Core (gRPC)

Коммуникации: gRPC (BFF ↔ сервисы), Kafka (события)

Данные: PostgreSQL (ORM EF Core + Dapper, Npgsql), YandexS3 для хранения фотографий (интеграция при помощи Amazon SDK для S3)

Надежность: MassTransit (+ Kafka), Quartz, Polly

Безопасность: JWT, BCrypt

Наблюдаемость: OpenTelemetry, Prometheus, Grafana, Jaeger, Serilog

Тесты: xUnit, Moq, Testcontainers

Инфраструктура: Docker, Docker Compose

## Тестирование

Юнит-тесты: xUnit, Moq
Тестируются доменная логика и use cases

Интеграционные тесты: Testcontainers
Поднимается контейнер PostgreSQL
Прогон миграций, проверка Inbox/Outbox, ORM-конфигураций
Требования к интеграционным тестам: установлен Docker
