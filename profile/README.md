Проект демонстрирует проектирование и реализацию распределенной информационной системы для каршеринг-компании. Система покрывает ключевые бизнес-процессы: учет автопарка, клиентов, бронирований и поездок, биллинг и платежи, уведомления и администрирование. Архитектура построена на DDD, микросервисах и событийно-ориентированном взаимодействии через Kafka. Для надежности применены SAGA (хореография), Transactional Outbox, Idempotent Consumer, корреляционные токены, трейсинг и метрики. Безопасность реализована на JWT.

## Функциональность

- [x] Управление автопарком: статусы ТС, телеметрия, обслуживание, история поездок
- [x] Клиенты: регистрация, KYC (проверка документов), блокировки/разблокировки
- [x] Бронирование и аренда: поиск на карте, резерв, фотофиксация
- [ ] Финансы: гибкие тарифы, расчеты, интеграция с платежными шлюзами, долги и штрафы, электронные чеки
- [ ] Администрирование: управление ролями и доступом, журналирование действий, зонами на карте, уведомления
- [ ] Отчетность и аналитика: загрузка парка, доходы, события и инциденты
- [ ] Наблюдаемость и устойчивость: метрики, логи, распределенный трейсинг, политики повторов, фоновые джобы

## Архитектура

Применены подходы DDD (Bounded Context) и Event Storeming для разрезания домена на микросервисы. Каждый микросервис коммуницирет асинхронно с другими сервисами. 

Принято решение отказаться от строгой согласованности в пользу итоговой. Для обеспечения согласованности при use кейсах, затрагивающих несколько микросервисов реализваны две хореографические саги.

Реализованы паттерны Transactional Outbox и Idempotent Consumer (Inbox).

Безопасность JWT (access/refresh), независимая проверка токена каждым сервисом пока не реализована, пока проверкой занимается микросервис identity.

## Микросервисы

#### BFF-шлюзы:
- [x] Customer
- [x] Employee
В планах разделить Employee на большее количество более автономных BFF.

#### Доменные сервисы:
- [x] Identity — Микросервис аутентификации и авторизации
- [x] Notification — Микросервис уведомлений
- [x] DrivingLicense — Микросервис подтверждения и отслеживания актуальности водительстких прав
- [x] Booking — Микросервис бронирования
- [x] VehicleCheck — Микросервис проверки состояния автомобиля клиентом перед арендой
- [x] VehicleDocuments — Микросервис для хранения документов от авто
- [x] VehicleFleet — Микросервис управления автопарком
- [x] Rent — Микросервис аренды авто

![](/assets/images/wheel-diagramm.png)

## Наблюдаемость

Метрики встроенные в: ASP.NET Core, Kestrel, gRPC, Npgsql, Quartz — через OpenTelemetry

Трейсинг: gRPC Interceptors для привязки X-Correlation-Id к span
В Jaeger видны сквозные треки: входящий gRPC → БД → Kafka produce/consume → фоновые задачи

Логи: Serilog, корреляция по токенам, структурированные записи

## Технологический стек

Платформа: .NET 8, ASP.NET Core (gRPC)

Коммуникации: gRPC (BFF ↔ сервисы), Kafka (события)

Данные: PostgreSQL (ORM EF Core + Dapper, Npgsql)

Надежность: MassTransit (+ Kafka), Quartz, Polly

Безопасность: JWT, BCrypt

Наблюдаемость: OpenTelemetry, Prometheus, Grafana, Jaeger, Serilog

Тесты: xUnit, Moq, Testcontainers

Инфраструктура: Docker, Docker Compose

## Тестирование

Юнит-тесты: xUnit, Moq
Тестируются доменная логика и use cases

Интеграционные тесты: Testcontainers
Поднимается контейнер PostgreSQL
Прогон миграций, проверка Inbox/Outbox, ORM-конфигураций
Требования к интеграционным тестам: установлен Docker
